var app={};$(document).ready(function(){(app={center:{lat:-41.16149186921309,lng:171.93083095625002},zoom:{default:6},vars:{lang:"en",languages:[],locations:[],vehicles:[],rentals:[],distance:{text:"",value:0},duration:{days:0,value:0},party:0,days:1,vehicle:null},tmp:[],assetsCount:0,loaded:!1,init:function(){return app.aAdd().include("https://maps.googleapis.com/maps/api/js?libraries=geometry,places&key="+("localhost"==window.location.hostname?"AIzaSyDUhuRDR9mGCjRK19_AJ0TYz1kK4lAOR9o":"AIzaSyCUlkyfiisV-1JwYVEITouh3qXed8ejS18"),"js",function(){app.contentAware().load()}),app.aAdd().include("https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.4.2/css/swiper.min.css","css",app.load),app.aAdd(2).include("https://cdnjs.cloudflare.com/ajax/libs/template7/1.2.3/template7.min.js","js",function(){app.aAdd().include("https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.4.2/js/swiper.jquery.js","js",function(){app.aAdd().include("js/poi.json","json",function(a){app.setVar("poi",a),app.aAdd(2).include("js/languages.json","json",function(a){app.setVar("languages",a),app.template("language",function(a){$("#loadingWrap").fadeOut(500),$("#languages").html(a),app.contentAware().load()}),app.load()}),app.load()}),app.load()}),app.load()}),app.aAdd().include("js/fuel.json","json",function(a){$.each(a,function(a,t){app.setVar(a,t)}),app.load()}),app.aAdd().include("js/vehicles.json","json",function(a){app.setVar("vehicles",a),app.load()}),app.aAdd().include("js/agents.json","json",function(a){app.setVar("agents",a),app.load()}),app},load:function(a){return app.loaded?app:("wait"!=a&&app.aAdd(-1),app.assetsCount>0||$('tmpl[data-wait="true"]').is("*")?app:($("#loadingWrap").fadeOut(500),$("#content.steps .step:not(.active)").hide(),app.map=new google.maps.Map(document.getElementById("map"),{center:app.center,zoom:app.zoom.default,clickableIcons:!1,disableDefaultUI:!0,disableDoubleClickZoom:!0,draggable:!1,scrollwheel:!1}),app.distanceService=new google.maps.DistanceMatrixService,app.directionsService=new google.maps.DirectionsService,app.directionsDisplay=new google.maps.DirectionsRenderer,app.directionsDisplay.setMap(null),app.loaded=!0,app.contentAware(),app))},include:function(a,t,e){if(a+=(/\?/.test(a)?"&":"?")+"_="+Date.now(),"css"==t){var s;(s=$("<link />")).attr("rel","stylesheet").attr("href",a).ready(e),$("body").append(s)}return"js"==t&&$.getScript(a,e),"json"==t&&$.getJSON(a,e),app},template:function(a,t,e,s){function p(a,t,e,s){return function(a,p,n){var o={};try{e?e.attr("parse")&&(o="#"==e.attr("parse").substr(0,1)?$('script[type="template/parse"][data-name="'+e.attr("parse").substr(1)+'"]').html():e.attr("parse"),o=JSON.parse(o)):s&&(o="string"==typeof s?JSON.parse(s):s)}catch(a){console.error("app.template","PARSE FAILED",a)}o.global=app.vars;var r;(r=$("<script />")).attr("type","text/plain"),r.html(a),r.find("script").each(function(){app.tmp.push($(this).html()),$(this).html(app.tmp.length-1)}),a=(a=Template7.compile(r.html()))(o),r.remove(),(r=$("<script />")).attr("type","text/plain"),r.html(a),r.find("script").each(function(){var a=Number($(this).html());$(this).html(app.tmp[a]),app.tmp[a]=""}),a=r.html(),r.remove(),t.call(e,a,p,n),app.contentAware()}}if("#"==a.substr(0,1)){var n=$('script[type="template/template"][data-name="'+a.substr(1)+'"]').html();p(a,t,e,s)(n,"success","internal")}else{var o;o="https://"==a.substr(0,8)||"http://"==a.substr(0,7)?a:"tmpl/"+(a=a.replace(new RegExp("{{global.lang}}","g"),app.vars.lang))+".html",$.ajax({url:o,success:p(a,t,e,s),cache:!1})}return app},contentAware:function(){function a(a){var t=!1,e=!1,s=!1;if(app.setVar("distance",{text:"",value:0}),app.setVar("duration",{days:0,value:0}),app.setVar("locations",[]),$("#steps_route .stepLocation").each(function(){$(this).find(".form-control").data("searchBox").getPlace()&&$(this).find(".form-control").val()&&("start"==$(this).attr("data-stop")&&(e=!0),"end"==$(this).attr("data-stop")&&(s=!0))}),e&&s||(t=!0),$("#steps_route .stepLocation .form-control").each(function(){var a=!1;$(this).parent().removeClass("has-error"),$(this).data("searchBox").getPlace()&&$(this).val()?($(this).data("marker").setMap(app.map),$(this).data("marker").setPosition($(this).data("searchBox").getPlace().geometry.location)):(($(this).parent().parent().attr("data-stop")||$(this).val())&&(a=!0),a&&($(this).parent().addClass("has-error"),t=!0),!a&&$(this).val()||$(this).data("marker").setMap(null))}),$("#steps_route_error").addClass("hide"),$("#steps_route_next").attr("disabled","disabled"),t)app.directionsDisplay.setMap(null),$("#steps_route .stepLocation .form-control").each(function(){$(this).data("marker").setMap($(this).val()?app.map:null)});else{app.directionsDisplay.setMap(app.map);var p={origin:{},destination:{},waypoints:[],travelMode:"DRIVING"};p.origin=$('#steps_route .stepLocation[data-stop="start"] .form-control').data("searchBox").getPlace().geometry.location,p.destination=$('#steps_route .stepLocation[data-stop="end"] .form-control').data("searchBox").getPlace().geometry.location,app.vars.locations.push(p.origin),$("#steps_route .stepLocation:not([data-stop])").each(function(){if(!$(this).hasClass("has-error")&&$(this).find(".form-control").val()){var a={location:$(this).find(".form-control").data("searchBox").getPlace().geometry.location,stopover:!0};p.waypoints.push(a),app.vars.locations.push(a.location)}}),app.vars.locations.push(p.destination),app.directionsService.route(p,function(a,t){if("OK"==t){var e=0,s=0;if($.each(a.routes[0].legs,function(a,t){e+=t.distance.value,s+=t.duration.value}),app.vars.distance.text=Math.ceil(e/1e3)+"km",app.vars.distance.value=e,app.vars.duration.days=Math.max(2,Math.ceil((s+7200*(app.vars.locations.length-2))/50400))+1,app.vars.duration.value=s,app.vars.distance.value<5e4)return void app.template("#steps/route/error/short",function(a){$("#steps_route_error").removeClass("hide").find("span").html(a)});app.vars.duration.days>app.vars.days&&app.manageDays("set",app.vars.duration.days),app.template("#steps/days/info",function(a){$("#steps_route_info").html(a)},null,{}),$("#steps_route_next").removeAttr("disabled"),app.directionsDisplay.setDirections(a),$("#steps_route .stepLocation .form-control").each(function(){$(this).data("marker").setMap(null)})}else app.template("#steps/route/error/none",function(a){$("#steps_route_error").removeClass("hide").find("span").html(a)})})}}return"undefined"==typeof Template7||"undefined"==typeof google?app:($("tmpl").each(function(){$(this).data("dataInit")||($(this).data("dataInit",!0),app.template($(this).attr("src"),function(a){var t="true"==$(this).attr("data-wait");$(this).after(a).remove(),t&&app.load("wait"),app.contentAware()},$(this)))}),$("[data-action]").each(function(){$(this).data("dataAction",$(this).attr("data-action")).removeAttr("data-action").click(function(a){var t=$(this).data("dataAction").split(":");app[t[0]].apply($(this),t[1]?t[1].split(","):[]),a.preventDefault()})}),$("#steps_start .stepSwiper").each(function(){var a=new Swiper(this,{paginationClickable:!1,preloadImages:!1,lazyLoading:!0,spaceBetween:20,autoplay:5e3,autoplayDisableOnInteraction:!0});$(this).data("swiper",a)}),$("#steps_route .stepLocation .form-control").each(function(){if(!$(this).data("dataInit")){$(this).data("dataInit",!0),$(this).on("focus",function(){$(this).val(""),$(this).data("marker").setMap(null),a("focus")});var t=new google.maps.Marker,e=new google.maps.places.Autocomplete(this,{componentRestrictions:{country:"nz"}});$(this).data("marker",t),$(this).data("searchBox",e),$(this).data("searchBox").addListener("place_changed",function(){e.getPlace()&&($(this).parent().removeClass("has-error"),a("change"))})}}),$("#steps_party .stepParty .stepParty-item").each(function(){$(this).data("dataInit")||($(this).data("dataInit",!0),$(this).click(function(){app.vars.party=Number($(this).find("img").attr("data-party")),$("#steps_party_next").removeAttr("disabled"),$("#steps_party .stepParty .stepParty-item").removeClass("active"),$(this).addClass("active")}))}),app)},setLang:function(a){return $("html").attr("lang",a),app.setVar("lang",a),$("#loadingWrap small,#loadingWrap span[lang]").hide(),$('#loadingWrap [lang="'+a+'"]').show(),$("#loadingWrap").fadeIn(500,function(){$("#languageWrap").hide(),app.template("main",function(a){$("#wrapper").html(a),app.contentAware().load()})}),app},setStep:function(a){return $(this).attr("disabled")?app:($("#content.steps .step.active").removeClass("active").slideUp(300),$('#content.steps .step[data-step="'+a+'"]').addClass("active").slideDown(300),"vehicles"==a&&(app.setVar("rentals",[]),$.each(app.vars.vehicles,function(a,t){if(!(app.vars.party<t.party.min||app.vars.party>t.party.max||app.vars.days<t.days.min||app.vars.days>t.days.max)){var e=t;e.id=a,e.fuel_cost=(t.fuel/100*app.vars.fuel*(app.vars.distance.value/1e3)).toFixed(2),app.vars.rentals.push(e)}}),app.template("#steps/vehicles/vehicle",function(a){$("#steps_vehicles_list").html(a)})),app.contentAware(),app)},manageStops:function(a,t){var e=$("#steps_route .stepLocation:not([data-stop])").length;return"add"==a&&(e++,app.template("#steps/route/destination",function(a){$("#steps_route .stepLocation:not([data-stop]):last").after(a)},null,{num:e})),e>=20?$("#steps_route .stepLocation-add").hide():$("#steps_route .stepLocation-add").show(),app},manageDays:function(a,t){var e=Number($("#steps_route_num").html());return"add"==a&&e++,"remove"==a&&e--,"set"==a&&(e=t),(e<1||e>30)&&(e=e<1?1:30),$("#steps_route_num").html(e),app.setVar("days",e),app},selectVehicle:function(a){a=Number(a),app.setVar("vehicle",a);var t=app.vars.vehicles[a];return t.agentInfo=app.vars.agents[t.agent],t.prices={},t.prices.days=Number(t.price*app.vars.days),t.prices.fuel=Number((t.fuel/100*app.vars.fuel*(app.vars.distance.value/1e3)).toFixed(2)),t.prices.total=t.prices.days+t.prices.fuel,app.template("#infobox",function(a){$(a).modal("show").bind("hidden.bs.modal",function(){$(".modal,.modal-backdrop").remove()}).bind("shown.bs.modal",function(){app.contentAware()})},null,t),app},setVar:function(a,t){return app.vars[a]=t,app},aAdd:function(a){return app.assetsCount+=a||1,app},reload:function(){return $(".modal:visible").modal("hide"),$("#loadingWrap").show(),app.loaded=!1,app.template("main",function(a){$("#wrapper").html(a),app.load()}),app}}).init()});